<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#7CB342">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>elink - EV Charging</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div id="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <img src="/E-Link-1024x500.png" alt="elink" class="logo">
        <img src="/inova-logo.png" alt="INOVA MK" class="logo partner-logo" onerror="this.style.display='none'">
        <h1>EV Charging</h1>
      </div>
      <div class="header-right">
        <div class="stats-badge" id="statsBadge">Loading...</div>
        <div class="connection-status" id="connectionStatus">
          <span class="dot offline"></span>
          <span>Connecting...</span>
        </div>
      </div>
    </header>

    <!-- Search Bar -->
    <div class="search-bar" id="searchBar">
      <input type="text" id="searchInput" placeholder="Search stations..." autocomplete="off">
      <div class="search-results hidden" id="searchResults"></div>
    </div>

    <!-- Map View -->
    <div id="map"></div>

    <!-- Station Panel (slides up when station selected) -->
    <div class="panel" id="stationPanel">
      <div class="panel-handle" onclick="closePanel()"></div>
      
      <!-- Station Info -->
      <div class="station-header">
        <h2 id="stationName">Station</h2>
        <span class="status-badge" id="stationStatus">Offline</span>
      </div>
      
      <div class="station-details">
        <div class="detail-row">
          <span class="label">Power Output</span>
          <span class="value" id="stationPower">-- kW</span>
        </div>
        <div class="detail-row">
          <span class="label">Connector Type</span>
          <span class="value">Type 2 AC</span>
        </div>
        <div class="detail-row">
          <span class="label">Address</span>
          <span class="value" id="stationAddress">--</span>
        </div>
      </div>

      <!-- Charging Status (shown during active session) -->
      <div class="charging-display hidden" id="chargingDisplay">
        <!-- Battery Indicator -->
        <div class="battery-indicator">
          <div class="battery-icon">
            <div class="battery-fill" id="batteryFill" style="width: 0%"></div>
          </div>
          <div class="battery-info">
            <div class="battery-percent" id="batteryPercent">0%</div>
            <div class="battery-label">Battery Level</div>
          </div>
        </div>

        <!-- Charging Stats -->
        <div class="charging-stats">
          <div class="stat">
            <span class="stat-value" id="currentPower">0</span>
            <span class="stat-unit">kW</span>
            <span class="stat-label">Power</span>
          </div>
          <div class="stat primary">
            <span class="stat-value" id="energyDelivered">0.00</span>
            <span class="stat-unit">kWh</span>
            <span class="stat-label">Energy</span>
          </div>
          <div class="stat">
            <span class="stat-value" id="chargingTime">0:00</span>
            <span class="stat-unit"></span>
            <span class="stat-label">Duration</span>
          </div>
        </div>

        <!-- Cost Display -->
        <div class="cost-display">
          <div class="cost-amount" id="costAmount">‚Ç¨0.00</div>
          <div class="cost-label">Estimated Cost</div>
        </div>

        <!-- Technical Details (collapsible) -->
        <div class="technical-data" id="technicalData" style="display: none;">
          <div class="tech-header" onclick="toggleTechnicalData()">
            <span>üìä Technical Data</span>
            <span class="toggle-icon" id="techToggleIcon">‚ñº</span>
          </div>
          <div class="tech-content" id="techContent" style="display: none;">
            <div class="tech-row">
              <span class="tech-label">Voltage</span>
              <span class="tech-value" id="techVoltage">-- V</span>
            </div>
            <div class="tech-row">
              <span class="tech-label">Current</span>
              <span class="tech-value" id="techCurrent">-- A</span>
            </div>
            <div class="tech-row">
              <span class="tech-label">Temperature</span>
              <span class="tech-value" id="techTemperature">-- ¬∞C</span>
            </div>
            <div class="tech-row">
              <span class="tech-label">Max Power</span>
              <span class="tech-value" id="techMaxPower">-- kW</span>
            </div>
            <div class="tech-row">
              <span class="tech-label">Data Age</span>
              <span class="tech-value" id="techDataAge">-- s</span>
            </div>
          </div>
        </div>

        <!-- Charging Animation -->
        <div class="charging-animation">
          <div class="pulse"></div>
          <span>Charging in progress...</span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="actions" id="actions">
        <button class="btn btn-primary" id="startBtn" onclick="showPayment()">
          ‚ö° Start Charging
        </button>
        <button class="btn btn-danger hidden" id="stopBtn" onclick="stopCharging()">
          ‚èπ Stop Charging
        </button>
        <button class="btn btn-secondary" id="navigateBtn" onclick="navigateToStation()" style="background:#2196F3;color:white;margin-top:8px">
          Navigate
        </button>
      </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal hidden" id="paymentModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Payment</h3>
          <button class="close-btn" onclick="closePayment()">&times;</button>
        </div>
        <div class="modal-body">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px;padding:10px 14px;background:#f0faf0;border-radius:8px;font-size:13px;color:#2e7d32">
            <span style="font-size:16px">&#128274;</span> Secure payment powered by eLink
          </div>

          <div class="form-group">
            <label>Card Number</label>
            <div style="position:relative">
              <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456"
                     maxlength="19" inputmode="numeric" autocomplete="cc-number"
                     style="padding-right:60px">
              <span id="cardBrandIcon" style="position:absolute;right:12px;top:50%;transform:translateY(-50%);font-size:24px;opacity:0.6"></span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Expiry Date</label>
              <input type="text" id="cardExpiry" placeholder="MM / YY" maxlength="5" autocomplete="cc-exp">
            </div>
            <div class="form-group">
              <label>Security Code</label>
              <input type="password" id="cardCvv" placeholder="CVV" maxlength="4" inputmode="numeric" autocomplete="cc-csc">
            </div>
          </div>

          <div id="cardError" style="display:none;color:#c62828;font-size:13px;margin-bottom:12px;padding:8px 12px;background:#ffebee;border-radius:8px"></div>

          <button class="btn btn-primary btn-full" id="payBtn" onclick="processPayment()" style="position:relative;overflow:hidden">
            <span id="payBtnText">Authorize & Start Charging</span>
            <span id="payBtnSpinner" style="display:none;position:absolute;inset:0;background:#689F38;display:none;align-items:center;justify-content:center">
              Processing...
            </span>
          </button>

          <div style="text-align:center;margin-top:14px;font-size:11px;color:#aaa">
            Visa, Mastercard, and Maestro accepted
          </div>
        </div>
      </div>
    </div>

    <!-- Session Summary Modal -->
    <div class="modal hidden" id="summaryModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>‚úÖ Session Complete</h3>
          <button class="close-btn" onclick="closeSummary()">&times;</button>
        </div>
        <div class="modal-body summary-content">
          <div class="summary-icon">‚ö°</div>
          <h3 class="summary-title">Charging Complete!</h3>
          <p class="summary-subtitle">Thank you for charging with elink</p>
          
          <div class="summary-stats">
            <div class="summary-stat">
              <span class="summary-stat-label">Energy Delivered</span>
              <span class="summary-stat-value" id="summaryEnergy">0.00 kWh</span>
            </div>
            <div class="summary-stat">
              <span class="summary-stat-label">Charging Duration</span>
              <span class="summary-stat-value" id="summaryDuration">0:00</span>
            </div>
            <div class="summary-stat">
              <span class="summary-stat-label">Average Power</span>
              <span class="summary-stat-value" id="summaryAvgPower">0 kW</span>
            </div>
            <div class="summary-stat">
              <span class="summary-stat-label">Total Cost</span>
              <span class="summary-stat-value highlight" id="summaryCost">‚Ç¨0.00</span>
            </div>
          </div>
          
          <button class="btn btn-primary btn-full" onclick="closeSummary()">
            Done
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast hidden" id="toast">
      <span class="toast-icon">‚ÑπÔ∏è</span>
      <span id="toastMessage"></span>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="/app.js"></script>
</body>
</html>
